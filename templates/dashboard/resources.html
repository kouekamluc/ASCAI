{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Resources - ASCAI" %}{% endblock %}

{% block content %}
<div class="reddit-landing-wrapper">
    <!-- Hero Section -->
    <div class="container">
        <div class="reddit-hero">
            <h1 class="reddit-hero-title">{% trans "Resources" %}</h1>
            <p class="reddit-hero-subtitle">{% trans "Useful links, documents, and resources for diaspora students" %}</p>
        </div>
    </div>

    <!-- Main Content -->
    <div class="reddit-container">
        <div class="reddit-main-feed">
            <!-- Documents Section -->
            <div class="reddit-section-header">
                <h2 class="reddit-section-title">{% trans "Documents & Downloads" %}</h2>
            </div>
            
            <!-- Search and Filter -->
            <div class="reddit-search">
                <form method="get" style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
                    <input type="text" name="search" value="{{ search_query }}" placeholder="{% trans 'Search documents...' %}" class="reddit-search-input" style="flex: 1;">
                    <button type="submit" class="reddit-btn reddit-btn-primary">{% trans "Search" %}</button>
                </form>
                
                {% if accessible_folders %}
                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem;">
                    <a href="{% url 'dashboard:resources' %}" class="reddit-btn {% if not current_folder %}reddit-btn-cameroon{% else %}reddit-btn-outline{% endif %}" style="font-size: 0.75rem; padding: 0.375rem 0.75rem;">
                        {% trans "All Documents" %}
                    </a>
                    {% for folder in accessible_folders %}
                    <a href="{% url 'dashboard:resources' %}?folder={{ folder.id }}" class="reddit-btn {% if current_folder.id == folder.id %}reddit-btn-cameroon{% else %}reddit-btn-outline{% endif %}" style="font-size: 0.75rem; padding: 0.375rem 0.75rem;">
                        {{ folder.name }}
                    </a>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            {% if doc_page_obj %}
            {% for doc in doc_page_obj %}
            <div class="reddit-post-card">
                <div class="reddit-post-vote">
                    <button class="reddit-vote-button" aria-label="{% trans 'Upvote' %}">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10 2L3 9h4v8h6v-8h4L10 2z"/>
                        </svg>
                    </button>
                    <span class="reddit-vote-count">‚Ä¢</span>
                    <button class="reddit-vote-button downvote" aria-label="{% trans 'Downvote' %}">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M10 18l7-7h-4V3H7v8H3l7 7z"/>
                        </svg>
                    </button>
                </div>
                <div class="reddit-post-content">
                    <div class="reddit-post-header">
                        <span class="reddit-post-subreddit">r/ASCAI-Documents</span>
                        <span>‚Ä¢</span>
                        <span class="reddit-post-author">{{ doc.created_at|date:"M d, Y" }}</span>
                        {% if doc.file %}
                        <span>‚Ä¢</span>
                        <span>{{ doc.file.size|filesizeformat }}</span>
                        {% endif %}
                    </div>
                    <a href="{{ doc.file.url }}" target="_blank" rel="noopener" class="reddit-post-title">{{ doc.title }}</a>
                    {% if doc.description %}
                    <p class="reddit-post-body">{{ doc.description|truncatewords:30 }}</p>
                    {% endif %}
                    {% if doc.tags.all %}
                    <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0;">
                        {% for tag in doc.tags.all|slice:":5" %}
                        <span style="background-color: #F7F9FA; color: var(--reddit-text); padding: 0.25rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; border: 1px solid var(--reddit-border);">
                            {{ tag.name }}
                        </span>
                        {% endfor %}
                    </div>
                    {% endif %}
                    <div class="reddit-post-footer">
                        <a href="{{ doc.file.url }}" download class="reddit-btn reddit-btn-cameroon">{% trans "Download" %}</a>
                        <a href="{{ doc.file.url }}" target="_blank" rel="noopener" class="reddit-btn reddit-btn-outline">{% trans "View" %}</a>
                    </div>
                </div>
            </div>
            {% endfor %}
            
            <!-- Pagination -->
            {% if doc_page_obj.has_other_pages %}
            <div style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin: 2rem 0;">
                {% if doc_page_obj.has_previous %}
                <a href="?doc_page={{ doc_page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_folder %}&folder={{ current_folder.id }}{% endif %}" class="reddit-btn reddit-btn-outline">{% trans "Previous" %}</a>
                {% endif %}
                <span style="font-size: 0.875rem; color: var(--reddit-text-secondary);">
                    {% trans "Page" %} {{ doc_page_obj.number }} {% trans "of" %} {{ doc_page_obj.paginator.num_pages }}
                </span>
                {% if doc_page_obj.has_next %}
                <a href="?doc_page={{ doc_page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}{% if current_folder %}&folder={{ current_folder.id }}{% endif %}" class="reddit-btn reddit-btn-outline">{% trans "Next" %}</a>
                {% endif %}
            </div>
            {% endif %}
            {% else %}
            <div class="reddit-sidebar-card">
                <div class="reddit-sidebar-content">
                    <p style="text-align: center; color: var(--reddit-text-secondary); padding: 2rem;">
                        {% trans "No documents available at the moment." %}
                    </p>
                </div>
            </div>
            {% endif %}

            <div class="cameroon-flag-accent"></div>

            <!-- Useful Links Section -->
            <div class="reddit-section-header">
                <h2 class="reddit-section-title">{% trans "Useful Links" %}</h2>
            </div>
            
            {% if link_categories %}
            <div class="reddit-feature-grid">
                {% for category in link_categories %}
                <div class="reddit-feature-card">
                    <div class="reddit-feature-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                    </div>
                    <h3 class="reddit-feature-title">{{ category.name }}</h3>
                    {% if category.description %}
                    <p class="reddit-feature-description">{{ category.description }}</p>
                    {% endif %}
                    {% if category.links.all %}
                    <div style="margin-top: 1rem;">
                        {% for link in category.links.all %}
                        <a href="{{ link.url }}" {% if link.is_external %}target="_blank" rel="noopener"{% endif %} class="reddit-sidebar-item" style="padding: 0.5rem 0; border-bottom: 1px solid var(--reddit-border);">
                            <span class="reddit-sidebar-text" style="flex: 1;">{{ link.name }}</span>
                            {% if link.is_external %}
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" style="color: var(--reddit-text-secondary);">
                                <path d="M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0zM1.5 8a6.5 6.5 0 1 1 13 0 6.5 6.5 0 0 1-13 0z"/>
                                <path d="M7.5 4.5a.5.5 0 0 1 1 0v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3z"/>
                            </svg>
                            {% endif %}
                        </a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p style="font-size: 0.875rem; color: var(--reddit-text-secondary); margin-top: 0.5rem;">
                        {% trans "No links in this category yet." %}
                    </p>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div class="reddit-sidebar-card">
                <div class="reddit-sidebar-content">
                    <p style="text-align: center; color: var(--reddit-text-secondary); padding: 2rem;">
                        {% trans "No useful links available at the moment." %}
                    </p>
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <aside class="reddit-sidebar">
            <div class="reddit-sidebar-card">
                <div class="reddit-sidebar-header">
                    <span>{% trans "Quick Actions" %}</span>
                </div>
                <div class="reddit-sidebar-content">
                    <a href="{% url 'documents:list' %}" class="reddit-sidebar-item">
                        <span class="reddit-sidebar-number">üìÑ</span>
                        <span class="reddit-sidebar-text">{% trans "All Documents" %}</span>
                    </a>
                    <a href="{% url 'dashboard:index' %}" class="reddit-sidebar-item">
                        <span class="reddit-sidebar-number">üè†</span>
                        <span class="reddit-sidebar-text">{% trans "Home" %}</span>
                    </a>
                    <a href="{% url 'dashboard:contact' %}" class="reddit-sidebar-item">
                        <span class="reddit-sidebar-number">üìß</span>
                        <span class="reddit-sidebar-text">{% trans "Contact" %}</span>
                    </a>
                </div>
            </div>

            {% if doc_page_obj %}
            <div class="reddit-sidebar-card">
                <div class="reddit-sidebar-header">
                    <span>{% trans "Document Stats" %}</span>
                </div>
                <div class="reddit-sidebar-content">
                    <div class="reddit-community-stats">
                        <div class="reddit-stat">
                            <div class="reddit-stat-value">{{ doc_page_obj.paginator.count|default:"0" }}</div>
                            <div class="reddit-stat-label">{% trans "Documents" %}</div>
                        </div>
                        <div class="reddit-stat">
                            <div class="reddit-stat-value">{{ link_categories|length|default:"0" }}</div>
                            <div class="reddit-stat-label">{% trans "Categories" %}</div>
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}
        </aside>
    </div>
</div>
{% endblock %}
