{% load i18n %}
{% load forum_tags %}
<div class="reply-item" id="reply-{{ reply.pk }}">
    {% if user.is_authenticated and reply_content_type_id %}
    {% with vote_info=reply_vote_data|get_item:reply.pk|default_if_none:None %}
    <div class="vote-section">
        <form method="post" action="{% url 'forums:vote' %}" class="vote-form" data-vote-type="upvote">
            {% csrf_token %}
            <input type="hidden" name="content_type" value="{{ reply_content_type_id }}">
            <input type="hidden" name="object_id" value="{{ reply.pk }}">
            <input type="hidden" name="vote_type" value="upvote">
            <button type="submit" class="vote-btn upvote {% if vote_info and vote_info.user_vote and vote_info.user_vote.vote_type == 'upvote' %}active{% endif %}" aria-label="{% trans 'Upvote' %}">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2L2 12h4v10h12V12h4L12 2z"/>
                </svg>
            </button>
        </form>
        <span class="vote-score" id="reply-vote-{{ reply.pk }}">{% if vote_info %}{{ vote_info.score|default:0 }}{% else %}0{% endif %}</span>
        <form method="post" action="{% url 'forums:vote' %}" class="vote-form" data-vote-type="downvote">
            {% csrf_token %}
            <input type="hidden" name="content_type" value="{{ reply_content_type_id }}">
            <input type="hidden" name="object_id" value="{{ reply.pk }}">
            <input type="hidden" name="vote_type" value="downvote">
            <button type="submit" class="vote-btn downvote {% if vote_info and vote_info.user_vote and vote_info.user_vote.vote_type == 'downvote' %}active{% endif %}" aria-label="{% trans 'Downvote' %}">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 22L2 12h4V2h12v10h4L12 22z"/>
                </svg>
            </button>
        </form>
    </div>
    {% endwith %}
    {% endif %}
    <div class="reply-content-wrapper">
        <div class="reply-meta">
            <strong>{{ reply.author.full_name }}</strong>
            <span style="color: #80868b;">{% blocktrans with time=reply.created_at|timesince %}{{ time }} ago{% endblocktrans %}</span>
            {% if reply.is_edited %}
                <span class="badge" style="background: rgba(0, 0, 0, 0.06); color: #5f6368;">{% trans "Edited" %}</span>
            {% endif %}
        </div>
        <div class="reply-content">
            {{ reply.content|safe }}
        </div>
        <div class="reply-actions">
            {% if reply.author == user or user.is_admin or user.is_board_member %}
                <a href="{% url 'forums:reply_update' reply.thread.slug reply.pk %}" class="btn btn-sm" style="background: rgba(0, 0, 0, 0.05); color: #1a1a1a; border: none;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.375rem;">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    {% trans "Edit" %}
                </a>
                <a href="{% url 'forums:reply_delete' reply.thread.slug reply.pk %}" class="btn btn-sm btn-danger">{% trans "Delete" %}</a>
            {% endif %}
            {% if user.is_authenticated and reply_content_type_id %}
                <a href="{% url 'forums:flag_content' %}?content_type={{ reply_content_type_id }}&object_id={{ reply.pk }}" class="btn btn-sm" style="background: rgba(0, 0, 0, 0.05); color: #1a1a1a; border: none;">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 0.375rem;">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                        <line x1="4" y1="22" x2="4" y2="15"></line>
                    </svg>
                    {% trans "Report" %}
                </a>
            {% endif %}
        </div>
    </div>
</div>

